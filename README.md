---

# TSTS v22.15 (Triggerable Sensor Telemetry System)

iPhoneの内部センサーを活用し、車両の動態データ（加速度・旋回角速度・GPS速度）を高精度にロギング・転送する、モータースポーツ・エンジニアリングに特化したテレメトリシステムです。

## 🚀 主要機能

### 1. 速度連動オートロギング（デュアルトリガー）

GPS速度をトリガーとした自動記録開始・停止制御を搭載。

* **10km/h 設定**: 小走り程度の微速域からロギングを開始。ピット内の低速移動や、セットアップ変更直後の挙動確認に有効。
* **50km/h 設定**: コースイン後の加速に合わせてロギングを開始。不要な停止データを排除し、解析効率を向上。

### 2. インテリジェント・データロギング

* **高周波サンプリング**: 加速度（G）、ジャイロ（角速度）、GPS座標を同期させ、一元化したバッファに保存。
* **アンチチャタリング**: 低速コーナーや渋滞時に記録が途切れないよう、8秒間の停止猶予タイマーを実装。

### 3. P2P リアルタイム通信

* **PARENT-CHILD 連携**: PeerJS を介し、車両搭載機（PARENT）のデータを手元のモニター機（CHILD）へ低遅延で転送。

### 4. 富士スピードウェイ (FSW) 特化解析

* **V-Min 自動検知**: FSWの主要コーナー（T1, T3, T6, T10等）でのボトムスピードを自動算出。
* **自動タイム計測**: 設定された各セクターゲート通過時にタイムを計測し、Google Apps Script (GAS) 経由でスプレッドシートへ自動ポスト。

## 🛠 運用フロー

1. **システム初期化**
iPhoneのSafariで起動し、`CONNECT` を実行。デバイスモーションの利用承認および `NoSleep.js` によるスリープ防止を有効化します。
2. **トリガー選択**
計測目的に応じ、画面左上のセレクターで **10km/h** または **50km/h** を選択します。
3. **自動計測**
設定速度を超えると自動的に `REC ACTIVE` 状態（画面赤点滅）となり、ロギングが開始されます。
4. **データ保存**
セッション終了後、`LOG SAVE` ボタンを押下することで、バッファ内のデータを CSV 形式でローカルストレージにダウンロードします。

## 📊 CSV データ構造

出力されるCSVファイルは、以下のカラムで構成されます。

| カラム名 | 説明 | 単位 |
| --- | --- | --- |
| `time` | タイムスタンプ | hh:mm:ss.ms |
| `lat` | 緯度 | decimal degrees |
| `lng` | 経度 | decimal degrees |
| `speed` | GPS速度 | km/h |
| `accX/Y/Z` | 3軸加速度（重力含む） | m/s² |
| `gyroA/B/G` | 3軸回転速度（Alpha/Beta/Gamma） | deg/s |

---
